#!/bin/bash

set -e

SHORT_SHA="$(echo $1 | cut -c -7)"

# push to ECR
make push-images ENV=staging
# deploy to kubernetes
make kube-deploy ENV=staging

# deploy notifications
MSG="Deployed $SHORT_SHA <%= PROJECT %> to staging"
curl -X POST -H 'Content-type: application/json' --data '{"text": "'"$MSG"'"}' $SLACK_WEBHOOK
